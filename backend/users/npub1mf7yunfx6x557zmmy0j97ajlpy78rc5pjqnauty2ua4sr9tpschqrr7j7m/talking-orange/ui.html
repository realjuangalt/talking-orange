<!-- Talking Orange Project-Specific UI -->
<!-- This file contains HTML, CSS, and JavaScript specific to the Talking Orange AR project -->
<!-- It is loaded dynamically when the talking-orange target is detected -->

<style>
    /* Talking Orange Project-Specific Styles */
    /* Mobile-friendly styles */
    @media (max-width: 768px) {
        #ask-question-btn {
            padding: 12px 24px !important;
            font-size: 14px !important;
            min-width: 180px !important;
        }
        
        #test-thinking-btn, #test-talking-btn, #stop-audio-btn {
            padding: 12px 16px !important;
            font-size: 20px !important;
            min-width: 50px !important;
            min-height: 50px !important;
        }
        
        .language-toggle, .debug-controls {
            padding: 6px !important;
            font-size: 11px !important;
        }
        
        .language-toggle label {
            font-size: 11px !important;
            margin-right: 6px !important;
        }
        
        .language-toggle select {
            padding: 3px 6px !important;
            font-size: 11px !important;
        }
    }
    
    @media (max-width: 480px) {
        #ask-question-btn {
            padding: 10px 20px !important;
            font-size: 13px !important;
            min-width: 160px !important;
            bottom: 15px !important;
        }
        
        #test-thinking-btn, #test-talking-btn, #stop-audio-btn {
            padding: 10px 14px !important;
            font-size: 18px !important;
            min-width: 48px !important;
            min-height: 48px !important;
        }
        
        .language-toggle, .debug-controls {
            padding: 4px !important;
            font-size: 10px !important;
        }
    }
    
    /* Language Toggle - Top Left */
    #language-toggle-container {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 1000;
        background: rgba(0, 0, 0, 0.6);
        border-radius: 25px;
        padding: 8px 16px;
        display: flex;
        align-items: center;
        gap: 10px;
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    
    #language-toggle-btn {
        background: transparent;
        border: 2px solid rgba(255, 255, 255, 0.8);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        cursor: pointer;
        font-size: 14px;
        font-weight: bold;
        transition: all 0.3s ease;
        min-width: 60px;
    }
    
    #language-toggle-btn:hover {
        background: rgba(255, 255, 255, 0.2);
        border-color: white;
    }
    
    @media (max-width: 768px) {
        #language-toggle-container {
            top: 15px;
            left: 15px;
            padding: 6px 12px;
        }
        
        #language-toggle-btn {
            padding: 6px 12px;
            font-size: 12px;
            min-width: 50px;
        }
    }
</style>

<!-- Language Toggle - Top Left -->
<div id="language-toggle-container">
    <button id="language-toggle-btn" onclick="window.talkingOrangeToggleLanguage()">
        <span id="lang-display">EN</span>
    </button>
</div>

<script>
    // Talking Orange Project-Specific Language Toggle
    (function() {
        // Initialize currentLanguage if not set
        if (typeof window.currentLanguage === 'undefined') {
            window.currentLanguage = 'en';
        }
        
        // Update button text based on current language
        function updateTalkingOrangeButtonText() {
            const button = document.getElementById('ask-question-btn');
            if (!button) {
                return;
            }
            
            const currentLang = window.currentLanguage || 'en';
            if (currentLang === 'es') {
                button.textContent = 'Hacer Pregunta';
            } else {
                button.textContent = 'Ask Question';
            }
        }
        
        // Toggle language between English and Spanish
        window.talkingOrangeToggleLanguage = function() {
            const currentLang = window.currentLanguage || 'en';
            const newLang = currentLang === 'en' ? 'es' : 'en';
            window.currentLanguage = newLang;
            
            // Update language display
            const langDisplay = document.getElementById('lang-display');
            if (langDisplay) langDisplay.textContent = newLang.toUpperCase();
            
            // Update button text
            updateTalkingOrangeButtonText();
            
            // Update talking controller language if available
            if (window.talkingController && window.talkingController.introAudioUrl) {
                // Update intro audio URL based on language
                const getAudioUrl = window.getAudioUrl || function(filename) {
                    const target = window.currentTarget;
                    if (target && target.userId && target.projectName) {
                        if (filename.includes('intro-es')) {
                            return `/api/users/${target.userId}/${target.projectName}/media/videos/talking-orange-talking-animation/talking-intro-es.mp3`;
                        } else if (filename.includes('intro') || filename.includes('talking')) {
                            return `/api/users/${target.userId}/${target.projectName}/media/videos/talking-orange-talking-animation/talking-intro.mp3`;
                        }
                    }
                    return null;
                };
                
                window.talkingController.introAudioUrl = newLang === 'es' 
                    ? getAudioUrl('talking-intro-es.mp3')
                    : getAudioUrl('talking-intro.mp3');
            }
        };
        
        // Initialize button text on load
        setTimeout(() => {
            updateTalkingOrangeButtonText();
            const langDisplay = document.getElementById('lang-display');
            if (langDisplay) {
                langDisplay.textContent = (window.currentLanguage || 'en').toUpperCase();
            }
        }, 100);
        
        // Export for external access
        window.updateTalkingOrangeButtonText = updateTalkingOrangeButtonText;
    })();
</script>

<!-- Main Controls (bottom center) -->
<div id="talking-orange-controls" style="position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 1000; display: flex; gap: 10px; align-items: center;">
    <button id="ask-question-btn" onclick="window.askQuestion()" 
            style="background: #2196F3; color: white; border: none; padding: 15px 30px; border-radius: 25px; cursor: pointer; font-size: 16px; font-weight: bold; box-shadow: 0 4px 8px rgba(0,0,0,0.3); min-width: 200px;">
        Ask Question
    </button>
    
    <!-- Stop Button (hidden by default, shown when audio is playing) -->
    <button id="stop-audio-btn" onclick="window.stopAudio()" 
            title="Stop Speaking"
            style="background: rgba(244, 67, 54, 0.8); color: white; border: none; border-radius: 25px; cursor: pointer; font-size: 24px; box-shadow: 0 4px 8px rgba(0,0,0,0.3); min-width: 60px; min-height: 60px; padding: 15px 20px; display: none;">
        ‚úã
    </button>
    
    <!-- Test Animation Buttons -->
    <button id="test-thinking-btn" onclick="window.testThinkingAnimation()" 
            title="Test Thinking Animation"
            style="background: rgba(156, 39, 176, 0.8); color: white; border: none; border-radius: 25px; cursor: pointer; font-size: 24px; box-shadow: 0 4px 8px rgba(0,0,0,0.3); min-width: 60px; min-height: 60px; padding: 15px 20px;">
        ü§î
    </button>
    
    <button id="test-talking-btn" onclick="window.testTalkingAnimation()" 
            title="Test Talking Animation"
            style="background: rgba(255, 152, 0, 0.8); color: white; border: none; border-radius: 25px; cursor: pointer; font-size: 24px; box-shadow: 0 4px 8px rgba(0,0,0,0.3); min-width: 60px; min-height: 60px; padding: 15px 20px;">
        üó£Ô∏è
    </button>
</div>

<script>
    // Talking Orange Project-Specific JavaScript
    // NOTE: Voice processing and animation functions are now in project-specific modules:
    // - voice-processing.js (askQuestion, processVoiceInput, playAudioResponse, stopAudio)
    // - animation-controllers.js (testThinkingAnimation, testTalkingAnimation)
    // This UI file only handles UI-specific functionality like language toggle and button text updates.
    
    (function() {
        'use strict';
        
        // NOTE: Language toggle and button text updates are handled by the first script block
        // (talkingOrangeToggleLanguage and updateTalkingOrangeButtonText functions)
        
        // Test animation functions - these use the animation controllers from animation-controllers.js
        // They will be available after the modules load
        window.testThinkingAnimation = function() {
            console.log('üß™ Testing thinking animation (one cycle)...');
            if (!window.thinkingController) {
                console.error('‚ùå Thinking controller not initialized. Modules may not be loaded yet.');
                return;
            }
            // Stop any existing animations
            if (window.stopTalkingAnimation) window.stopTalkingAnimation();
            if (window.stopThinkingAnimation) window.stopThinkingAnimation();
            // Small delay to ensure previous animation is fully stopped
            setTimeout(() => {
                // Reset state before starting
                if (window.animationModule) {
                    window.animationModule.currentThinkingFrame = 0;
                    window.animationModule.currentThinkingState = 0;
                    window.animationModule.isThinking = false;
                }
                // Test mode: single play (no loop), with audio
                if (window.thinkingController) {
                    window.thinkingController.start({ loop: false, playAudio: true });
                } else {
                    console.error('‚ùå thinkingController not available');
                }
            }, 150);
        };
        
        window.testTalkingAnimation = function() {
            console.log('üß™ Testing talking animation (one cycle with intro)...');
            if (!window.talkingController) {
                console.error('‚ùå Talking controller not initialized. Modules may not be loaded yet.');
                return;
            }
            // Stop any existing animations
            if (window.stopTalkingAnimation) window.stopTalkingAnimation();
            if (window.stopThinkingAnimation) window.stopThinkingAnimation();
            // Small delay to ensure previous animation is fully stopped
            setTimeout(() => {
                // Reset state before starting
                if (window.animationModule) {
                    window.animationModule.currentTalkingFrame = 0;
                    window.animationModule.currentTalkingState = 0;
                    window.animationModule.talkingDirection = 1;
                    window.animationModule.isTalking = false;
                }
                // Test mode: single play (no loop) with intro audio
                if (window.talkingController) {
                    window.talkingController.start({ loop: false, playIntro: true });
                } else {
                    console.error('‚ùå talkingController not available');
                }
            }, 150);
        };
        
        // Wait for modules to load and verify functions are available
        const checkModules = setInterval(() => {
            if (window.askQuestion && window.stopAudio && window.thinkingController && window.talkingController) {
                console.log('‚úÖ All project modules loaded and ready');
                clearInterval(checkModules);
            }
        }, 100);
        
        // Stop checking after 10 seconds
        setTimeout(() => {
            clearInterval(checkModules);
            if (!window.askQuestion || !window.stopAudio) {
                console.warn('‚ö†Ô∏è Some project modules may not have loaded. Functions may not be available.');
            }
        }, 10000);
        
        console.log('‚úÖ Talking Orange project UI loaded');
    })();
</script>

